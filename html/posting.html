<!DOCTYPE html>

<html>

  <head>
    <link rel="stylesheet" href="http://localhost:8080/style.css ">
    <title> Forms </title>

  </head>
  <body onload="checkPost()">

    <script type="text/javascript">
    
      function addPost(){
        var http = new XMLHttpRequest();
        var url = '/postmessage';
        http.open('POST', url, true);

        var message = document.getElementById("data").value;

        var params ='topic_input='+document.getElementById("topic_input").value +'&data='+  document.getElementById("data").value;
        http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

        http.onreadystatechange = function () {
          if(http.readyState == 4 && http.status == 200) {

            alert("Your message has been posted");

          }
          else if (http.status >= 400){
            alert("Your mesage posting has failed");
          }
        };
        http.send(params);
      };




    </script>
    
    <script>
      function checkPost(){
        var http = new XMLHttpRequest();
        var url = '/post.txt';
        http.open('GET', url, true);
        var params = "Post-/n" + document.getElementById("textArea") + "/n";
        http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

        http.onreadystatechange = function () {
          if(http.readyState == 4 && http.status == 200) {

            document.getElementById("textArea").textContent = http.responseText;

          }
        };
        http.send();
        setTimeout('checkPost()', 500);
      };

    
    </script>

    <form>
      
      <div >
        <textarea id="textArea" rows="15" cols="100"></textarea> <br>
      </div>
      
      <div >
        <label for="topic">Topic:</label><br> <br>
        <input type="text" name="topic_input" value="topic" id="topic_input"><br> <br>

        <textarea id="data" name="data" rows="10" cols="30"> add text </textarea> <br>

        <button name="SEND" onclick="addPost()"> SEND </button>
      </div>
    </form>

  </body>

</html>